@model IEnumerable<OrderDetailViewModel>
@{
    ViewData["Title"] = "我的訂單";
}

<h1 class="commontxt">我的訂單</h1>

<hr />


@if (Model.Count() > 0)
{
    @foreach (var item in Model)
    {
        <div class="row bg-white shadow-sm mt-3 p-3 accordion accordion-flush">
            <div class="d-flex align-items-center">
                <img src="~/images/@item.orderproduct.First().ProdcutId/1.png" class="col-1 m-2">
                <div class="col-2">
                    <p class="text-secondary">訂單編號</p>
                    <a  asp-controller="Orderlist" asp-action="GetInfo" asp-route-id="@item.OrderId">@item.OrderId</a>
                </div>
                <div class="col-1"><p class="text-secondary">訂單狀態</p><h5>@item.Status</h5></div>
                <div class="col-1"><p class="text-secondary">總金額</p><h5>NT @Math.Round(item.TotalPrice)</h5></div>
                <div class="col-2"><p class="text-secondary">交易日期</p><p>@item.Orderdate</p></div>
                <div class="col-1">
                    <p class="text-secondary">折價券</p>
                    @if (item.CouponName != null)
                    {
                        <h5>@item.CouponName</h5>
                    }
                    else
                    {
                        <h5>-</h5>
                    }
                </div>
                <div class="col-2">
                    <p class="text-secondary">付款狀態</p>
                    @if(item.Payment != "")
                    {
                        <h5>已付款</h5>
                    }
                    else
                    {
                        <h5>未付款</h5>
                    }
                </div>
                <div class="col-1">
                    @if (item.Status == "未確認")
                    {
                        <a class="btn btn-danger"  asp-controller="User" asp-action="CancelOrder" asp-route-id="@item.OrderId">取消訂單</a>
                    }
                    else
                    {
                        <a class="btn btn-danger disabled" asp-controller="User" asp-action="CancelOrder" asp-route-id="@item.OrderId">取消訂單</a>
                    }
                </div>
            </div>
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#@item.OrderId" aria-expanded="false" aria-controls="flush-collapseOne">
                <h5>看明細</h5>
            </button>

            <div id="@item.OrderId" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
                @foreach (var p in item.orderproduct)
                {
                    <div class="d-flex align-items-center">
                        <a asp-controller="Products" asp-action="ProductDetail" asp-route-id="@p.ProdcutId" class="col-1 m-2">
                            <img src="~/images/@p.ProdcutId/1.png" class="img-con-ss">
                        </a>

                        <div class="col-3"><p class="text-secondary">產品名稱</p><h5>@p.ProductName @(p.SpecName == null ? "" : "-" + p.SpecName)</h5></div>
                        <div class="col-2"><p class="text-secondary">產品單價</p><h5>NT @Math.Round( p.Price)</h5></div>
                        <div class="col-3"><p class="text-secondary">數量</p><h5>x @p.Amount</h5></div>
                        <div class="col-3"><p class="text-secondary">商品小記</p><h5>NT @Math.Round( p.PriceTotal)</h5></div>
                    </div>
                }

            </div>
        </div>
    }

}
else
{
    <h5><center>您無購買過商品</center></h5>
}